import asyncio
import re
import time
import requests
import aiohttp
import time
import asyncio
import calendar
import random
import re
import textwrap
import aiofiles
import aiohttp
import time
import requests
import datetime
import sys
import config

from pyrogram import Client, filters
from pyrogram import filters
from datetime import datetime
from pyrogram import enums




from VeRoNMusic import app
from VeRoNMusic.utils.database import delete_served_chat, get_assistant, is_on_off
from pyrogram import Client, filters
from VeRoNMusic.core.userbot import Userbot
from pyrogram.types import Message, InlineKeyboardButton, InlineKeyboardMarkup
from config import OWNER_ID 
from VeRoNMusic import app
from VeRoNMusic.misc import SUDOERS
from config import OWNER_ID
from config import BANNED_USERS
from config import BANNED_USERS, OWNER_ID
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from pyrogram.types import CallbackQuery, InputMediaPhoto, InlineKeyboardMarkup, InlineKeyboardButton
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from pyrogram.enums import ChatType, ChatMemberStatus
from pyrogram.enums import ChatMemberStatus, ParseMode
from VeRoNMusic import app
from pyrogram.enums import ChatMembersFilter
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import ChatPermissions, ChatPrivileges
from config import *
from pyrogram.enums import ChatMembersFilter
from telegraph import upload_file
from asyncio import gather
from pyrogram.enums import ChatMembersFilter
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import ChatPermissions, ChatPrivileges
from config import *
from pyrogram.enums import ChatMembersFilter
import asyncio
import asyncio

import os
import time
import requests
from config import START_IMG_URL
from pyrogram import filters
import random
from pyrogram import Client
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from VeRoNMusic import (Apple, Resso, SoundCloud, Spotify, Telegram, YouTube, app)
from VeRoNMusic import app
from random import  choice, randint



import asyncio
from pyrogram import Client, filters
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from VeRoNMusic import app
import random
    

from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup
import random

from pyrogram.enums import ParseMode

from VeRoNMusic import app
from VeRoNMusic.utils.database import is_on_off




from pyrogram import filters
from pyrogram.types import *
from VeRoNMusic import app
from gpytranslate import Translator



from pyrogram import filters
from pyrogram import Client
from VeRoNMusic.core.call import KIM
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from VeRoNMusic import (Apple, Resso, SoundCloud, Spotify, Telegram, YouTube, app)
from VeRoNMusic import app
from telegraph import upload_file
from asyncio import gather

import random
from VeRoNMusic.misc import SUDOERS
from pyrogram.types import (Message,InlineKeyboardButton,InlineKeyboardMarkup,CallbackQuery,ChatPrivileges)
from pyrogram import filters, Client
from VeRoNMusic import app
from config import *

import asyncio
import os
import random
import re
import textwrap
import aiofiles
import aiohttp
from PIL import Image, ImageDraw, ImageEnhance, ImageFilter, ImageFont, ImageOps
from youtubesearchpython.__future__ import VideosSearch
import numpy as np

from config import YOUTUBE_IMG_URL
import platform
from sys import version as pyver
import aiohttp
import psutil
import asyncio
from pyrogram import __version__ as pyrover
from pyrogram import filters
from pyrogram import Client
from pyrogram.errors import MessageIdInvalid
from pyrogram.types import InputMediaPhoto, Message
from pytgcalls.__version__ import __version__ as pytgver
from config import OWNER_ID
import config
from VeRoNMusic import app
from VeRoNMusic.core.userbot import assistants
from VeRoNMusic.misc import SUDOERS, pymongodb
from VeRoNMusic.plugins import ALL_MODULES

from VeRoNMusic.utils.decorators.language import language, languageCB
from VeRoNMusic.utils.inline.stats import back_stats_buttons, stats_buttons
from config import BANNED_USERS
##
from pyrogram.enums import ChatType, ChatMemberStatus
from pyrogram.enums import ChatMemberStatus, ParseMode
from pyrogram.enums import ChatMembersFilter
from pyrogram.enums import ChatMemberStatus
from VeRoNMusic.misc import SUDOERS
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup, Message, ReplyKeyboardMarkup
from pyrogram.types import (InlineKeyboardButton,CallbackQuery,InlineKeyboardMarkup, Message)

from pyrogram.types import (InlineKeyboardButton, ChatPermissions, InlineKeyboardMarkup, Message, User)




import asyncio
import os
import time
import requests
import datetime
import random
import os
import time
from asyncio import sleep
from pyrogram import Client, filters
from pyrogram import enums, filters
from VeRoNMusic import app

from pytz import timezone
from pyrogram import enums
import aiohttp
import datetime
from pytz import timezone
from pyrogram import filters
from pyrogram import Client
from typing import Union
from random import choice
from config import OWNER_ID
from config import BANNED_USERS
from config import BANNED_USERS, OWNER_ID
from VeRoNMusic.core.call import KIM
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from pyrogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, InputMediaPhoto
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from VeRoNMusic import (Apple, Resso, SoundCloud, Spotify, Telegram, YouTube, app)
from VeRoNMusic import app
from telegraph import upload_file
from asyncio import gather
from pyrogram.errors import FloodWait
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup






import asyncio
from PIL import Image, ImageDraw, ImageFont
from pyrogram import filters, Client, enums
from pyrogram.types import *
from typing import Union, Optional
from VeRoNMusic import app as Hiroko 

# Function to get font and resize text


import random
from pyrogram import filters
from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton
import requests
from PIL import Image
import os


import asyncio
import re
import time
import requests
import aiohttp
import time
import asyncio
from pyrogram import Client, filters
from pyrogram import filters
from datetime import datetime
from pyrogram import enums
from VeRoNMusic.misc import SUDOERS
from config import OWNER_ID
from config import BANNED_USERS
from config import BANNED_USERS, OWNER_ID
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from pyrogram.types import CallbackQuery, InputMediaPhoto, InlineKeyboardMarkup, InlineKeyboardButton
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from pyrogram.enums import ChatType, ChatMemberStatus
from pyrogram.enums import ChatMemberStatus, ParseMode
from VeRoNMusic import app
from pyrogram.enums import ChatMembersFilter
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import ChatPermissions, ChatPrivileges
from config import *
from pyrogram.enums import ChatMembersFilter
from telegraph import upload_file
from asyncio import gather
from pyrogram.enums import ChatMembersFilter
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import ChatPermissions, ChatPrivileges
from config import *
from pyrogram.enums import ChatMembersFilter
import asyncio

from pyrogram.enums import ParseMode

from VeRoNMusic import app
from VeRoNMusic.utils.database import is_on_off




from pyrogram import filters
from pyrogram import Client
from VeRoNMusic.core.call import KIM
from pyrogram.enums import ChatMemberStatus
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup
from VeRoNMusic import (Apple, Resso, SoundCloud, Spotify, Telegram, YouTube, app)
from VeRoNMusic import app
from telegraph import upload_file
from asyncio import gather

import random
from VeRoNMusic.misc import SUDOERS
from pyrogram.types import (Message,InlineKeyboardButton,InlineKeyboardMarkup,CallbackQuery,ChatPrivileges)
from pyrogram import filters, Client
from VeRoNMusic import app
from config import *

import asyncio
from typing import Dict, List, Tuple

from pyrogram import Client, filters




def is_owner(_, __, message):
    return message.from_user.id == OWNER_ID



from PIL import Image, ImageDraw, ImageFont
import calendar
import io

        

@app.on_message(filters.command(["نتيجه","النتيجه"], "") & filters.group, group=4442)
async def cale_ndar(client: Client, message: Message):
    ask = await app.ask(message.chat.id, "ارسل الشهر بالارقام", timeout=300)
    mm = ask.text 
    yy = 2024 

    if mm.isdigit() and 1 <= int(mm) <= 12:

        img = Image.new('RGB', (600, 600), color='black')
        d = ImageDraw.Draw(img)
        fnt = ImageFont.truetype('VeRoNMusic/assets/font2.ttf', 30)
        cal = calendar.monthcalendar(yy, int(mm))
        for week_num, week in enumerate(cal):
            for day_num, day in enumerate(week):
                d.text((100 + day_num * 100, 50 + week_num * 50), str(day), font=fnt, fill='white')


        img_byte_arr = io.BytesIO()
        img.save(img_byte_arr, format='PNG')
        img_byte_arr.seek(0)


        await message.reply_photo(photo=img_byte_arr, caption=calendar.month(yy, int(mm)))
    else:
        await message.reply("شهر غير صالح. الرجاء إدخال رقم شهر صالح بين 1 و 12.")

    

    
    


MUSIC_BOT_NAME = {}

botname = {}


name = ""

@app.on_message(filters.regex("تعين اسم البوت") & filters.private & filters.user(OWNER_ID), group=609760)
async def set_bot_name(client, message):
    global name
    ask = await app.ask(message.chat.id, "ارسل الاسم البوت الجديد", timeout=300)
    name = ask.text
    await message.reply_text("تم تعيين الاسم للبوت بنجاح")

keemo_responses = [
    "اسمي <b>{name}<b> ياخي",
    "قتلك اسمي <b>{name}</b>",
    "نعم حبي اسمي <b>{name}</b>",
    "قول يقلب <b>{name}</b>",
    "ورحمة أبويا اسمي <b>{name}</b>",
    "يعم فكك مني",
    "ركز اسمي <b>{name}</b> يمسلم",
    "نديني <b>{name}</b>",
    "مش هرد عليك علشان اسمي <b>{name}</b>",
    "اسمي <b>{name}<b> المطرشم",
    "انا <b>{name}<b> ابو جلابيه الي مبشوفش",
    "ينحم اسمي <b>{name}</b>",
    "ارحم دين ام <b>{name}</b>",
    "هو <b>{name}<b> اسم شركه",
    "هو اسم <b>{name}<b> امك",
    " ولك يفضح عرضك شنو هاي",
    "ولك يفضح عرضك يزلمه",
    " انا <b>{name}<b> عجبك",
    "انا <b>{name}<b> المطرشم",
    "قرفت دين ام <b>{name}</b>",
    " نديني <b>{name}<b> يحب",
    " اسمي <b>{name}<b> يعرص",
    "اسمي <b>{name}<b> يصحبي",
    "يسطا قولتلك اسمي <b>{name}<b> الاه"
]

@app.on_message(filters.command(["بوت", "البوت","بوتي","بوتك"], ""), group=71135)
async def keemo_bot(client, message):
    global name
    bot_username = (await app.get_me()).username
    bar = random.choice(keemo_responses).format(name=name)
    keyboard = InlineKeyboardMarkup([
        [InlineKeyboardButton("꙳.خدني لجروبك.꙳", url=f"https://t.me/{bot_username}?startgroup=True")]
    ])

    await message.reply_text(
        text=f"{bar}",
        disable_web_page_preview=True,
        reply_markup=keyboard
    )


@app.on_message(filters.text & filters.group, group=55554)
async def gsgshshs(client, message):
    global name
    if message.text == name:
        bot_username = (await app.get_me()).username
        bar = random.choice(keemo_responses).format(name=name)
        keyboard = InlineKeyboardMarkup([
            [InlineKeyboardButton("꙳.خدني لجروبك.꙳", url=f"https://t.me/{bot_username}?startgroup=True")]
        ])

        await message.reply_text(
            text=f"{bar}",
            disable_web_page_preview=True,
            reply_markup=keyboard
        )

##
@app.on_message(filters.command(["صلاحياتي"], "") & filters.group, group=6662223)
async def privilegess(client, message):
    chat_id = message.chat.id
    user_id = message.from_user.id if message.from_user else "1121532100"
    kimmy = await client.get_chat_member(chat_id, user_id)
    status = kimmy.status if kimmy else None
    if status == ChatMemberStatus.OWNER:
        await message.reply_text("أنت مالك الجروب")
    elif status == ChatMemberStatus.MEMBER:
        await message.reply_text("أنت عضو حقير")
    else:
        privileges = kimmy.privileges if kimmy else None 
        can_promote_members = "√" if (privileges and privileges.can_promote_members) else "✘"
        can_manage_video_chats = "√" if (privileges and privileges.can_manage_video_chats) else "✘"
        can_pin_messages = "√" if (privileges and privileges.can_pin_messages) else "✘"
        can_invite_users = "√" if (privileges and privileges.can_invite_users) else "✘"
        can_restrict_members = "√" if (privileges and privileges.can_restrict_members) else "✘"
        can_delete_messages = "√" if (privileges and privileges.can_delete_messages) else "✘"
        can_change_info = "√" if (privileges and privileges.can_change_info) else "✘"
        sohailaa = f"<b>صلاحياتك في الجروب:</b>\n\n"
        sohailaa += f"<b>اضافة مشرفين:</b> {can_promote_members}\n"
        sohailaa += f"<b>إدارة البثوث المباشرة:</b> {can_manage_video_chats}\n"
        sohailaa += f"<b>تثبيت الرسائل:</b> {can_pin_messages}\n"
        sohailaa += f"<b>دعوة المستخدمين:</b> {can_invite_users}\n"
        sohailaa += f"<b>حظر المسخدمين:</b> {can_restrict_members}\n"
        sohailaa += f"<b>حذف الرسائل:</b> {can_delete_messages}\n"
        sohailaa += f"<b>تغيير معلومات المجموعة:</b> {can_change_info}\n"
        await message.reply_text(sohailaa)


# صلاحياته  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
# صلاحياته  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command(["صلاحياته"], "") & filters.group, group=2220190)
async def privilegess(client, message):
    chat_id = message.chat.id
    user_id = message.reply_to_message.from_user.id
    kimmy = await client.get_chat_member(chat_id, user_id)
    status = kimmy.status if kimmy else None
    if status == ChatMemberStatus.OWNER:
        await message.reply_text(" دا مالك الجروب")
    elif status == ChatMemberStatus.MEMBER:
        await message.reply_text("دا عضو حقير")
    else:
        privileges = kimmy.privileges if kimmy else None 
        can_promote_members = "√" if (privileges and privileges.can_promote_members) else "✘"
        can_manage_video_chats = "√" if (privileges and privileges.can_manage_video_chats) else "✘"
        can_pin_messages = "√" if (privileges and privileges.can_pin_messages) else "✘"
        can_invite_users = "√" if (privileges and privileges.can_invite_users) else "✘"
        can_restrict_members = "√" if (privileges and privileges.can_restrict_members) else "✘"
        can_delete_messages = "√" if (privileges and privileges.can_delete_messages) else "✘"
        can_change_info = "√" if (privileges and privileges.can_change_info) else "✘"
        kamall = f"<b>صلاحياته في الجروب:\n\n</b>"
        kamall += f"<b>اضافة مشرفين: {can_promote_members}</b>\n"
        kamall += f"<b>إدارة البثوث المباشرة: {can_manage_video_chats}</b>\n"
        kamall += f"<b>تثبيت الرسائل: {can_pin_messages}</b>\n"
        kamall += f"<b>دعوة المستخدمين: {can_invite_users}</b>\n"
        kamall += f"<b>حظر المسخدمين: {can_restrict_members}</b>\n"
        kamall += f"<b>حذف الرسائل: {can_delete_messages}</b>\n"
        kamall += f"<b>تغيير معلومات المجموعة: {can_change_info}</b>\n"
        await message.reply_text(kamall)



# لقبب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
# لقبب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓

@app.on_message(filters.command(["لقبي"], "") & filters.group, group=7272727866)
async def title(client, message):
    user_id = message.from_user.id if message.from_user else "1121532100"
    chat_id = message.chat.id
    user = await client.get_chat_member(chat_id, user_id)    
    if user.status in [ChatMemberStatus.OWNER]:
        await message.reply_text(f"مالك الجروب ✨")
    elif user.status == ChatMemberStatus.MEMBER:
     await message.reply_text("عضو ✨")
    elif user.status == ChatMemberStatus.ADMINISTRATOR:
        title = user.custom_title if user.custom_title else "مشرف"
        await message.reply_text(f"لقبك هو [{title}] ي روحي ✨")


# لقبه ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
# لقبه ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command(["لقبه"], "") & filters.group, group=72727866)
async def title(client, message):
    user_id = message.reply_to_message.from_user.id
    chat_id = message.chat.id
    user = await client.get_chat_member(chat_id, user_id)    
    if user.status in [ChatMemberStatus.OWNER]:
        await message.reply_text("مالك الجروب ✨")
    elif user.status == ChatMemberStatus.MEMBER:
     await message.reply_text("عضو ✨")
    elif user.status == ChatMemberStatus.ADMINISTRATOR:
        title = user.custom_title if user.custom_title else "مشرف"
        await message.reply_text(f"لقبه هو [{title}] ي روحي ✨")

        
# مين رفعني ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
# مين رفعني ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command(["مين رفعني"], "") & filters.group, group=72)
async def get_promoted_by(client, message):
    chat_id = message.chat.id
    user_id = message.from_user.id if message.from_user else "1121532100"
    member = await client.get_chat_member(chat_id, user_id)  
    if member.add_by:
        add_by = member.add_by.first_name
        await message.reply_text(f"تم رفعك من قبل {add_by} ✨")
    else:
        await message.reply_text("للاسف لسه محدش رفعك ي روحي ✨")
        

#تفليش خاص بمكور السورس ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تفليش خاص بمكور السورس ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓



@app.on_message(filters.command(["غادر"], "") & filters.group, group=27281)
async def leave(bot, message: Message):
    msg = await message.reply("🤬")
    await sleep(2)
    await msg.delete()
    if message.from_user.id == OWNER_ID or message.from_user.id == 8040979911:
        await message.reply_text('حاضر هطع من جروب')
        await bot.leave_chat(message.chat.id)
    else:
        await message.reply("لا مش هطلع من هنا مش 🥺😒")

#مسح الرسائل ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#مسح الرسائل ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command(["حذف"], ""), group=90027373630063)
async def get_restricted_users(client: Client, message: Message):
    if message.reply_to_message:
        reply_message = message.reply_to_message
        await message.delete()
        await reply_message.delete()
    else:
        await message.reply("لازم تعمل ريب ع الرساله ي روحي ✨")


#تثبيت الرسائل خاصه للمالك الجروب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تثبيت الرسائل خاصه للمالك الجروب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command("تثبيت", "") & filters.group, group=82762727)
async def ppin_message(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == 8040979911:
    if message.reply_to_message:
        await client.pin_chat_message(message.chat.id, message.reply_to_message.id)
        await message.reply_text(f"「 {message.from_user.mention} 」\nلقد ثبت الرساله\n༄ ")
    else:
        await message.reply("لازم تعمل ريب ع الرساله ي روحي ✨")
   else:
        await message.reply("لازم تكون ع الاقل ادمن او اعلي ✨")



@app.on_message(filters.command(["الغاء التثبيت"], "") & filters.group, group=727252637)
async def unpin_message(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == 8040979911:
    if message.reply_to_message:
        await client.unpin_chat_message(message.chat.id, message.reply_to_message.id)
        await message.reply_text(f"「 {message.from_user.mention} 」 الغيت تثبيت الرساله\n༄ ")
    else:
        await message.reply("هذا الامر ليس لك ✨")
   else:
        await message.reply("لازم تكون ع الاقل ادمن او اعلي ✨")    



@app.on_message(filters.command("الغاء تثبيت الكل", "") & filters.group, group=87878791004300)
async def unbanall(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == 8040979911:
       chat_id = message.chat.id
       await app.unpin_all_chat_messages(chat_id)
       await message.reply_text(f"تم الغاء تثيبت الكل「 {message.from_user.mention} 」بنجاح ✨")
   else:
        await message.reply("لازم تكون ع الاقل ادمن او اعلي ✨")


#تغير وصف و اسم الجروب خاص لمالك الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تغير وصف و اسم الجروب خاص لمالك الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓

                                   
@app.on_message(filters.command("تغير اسم الجروب", "") & filters.group, group=90876543)
async def tasfaghhhya(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER] or message.from_user.id == 8040979911:
       ask = await app.ask(message.chat.id, "ارسل الاسم الان", timeout=300)
       VEGAAA = ask.text
       chat_id = message.chat.id
       await app.set_chat_title(chat_id, VEGAAA)
       await message.reply_text(f"︎تم تغير اسم الجروب 「 {message.from_user.mention} 」بنجاح ✨")
   else:
        await message.reply("لازم تكون المالك ✨")


# مسح اسم الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
# مسح اسم الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command("مسح اسم الجروب", "") & filters.group, group=555580000250)
async def tasfaghddd(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER] or message.from_user.id == 8040979911:
        KIMMYY = ".."
        chat_id = message.chat.id
        if message.chat.title == KIMMYY:
            await message.reply("هييه مافيه اسم لجروب ياروع!!")
        else:
            await client.set_chat_title(chat_id, KIMMYY)
            await message.reply_text(f"تم مسح اسم الجروب 「 {message.from_user.mention} 」بنجاح ✨")
    else:
        await message.reply("لازم تكون المالك ✨")

#تغير بايو الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تغير بايو الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command("تغير بايو الجروب", "") & filters.group, group=80087651300)
async def tasfayahshsh(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER] or message.from_user.id == 8040979911:
       ask = await app.ask(message.chat.id, "ارسل بايو الان", timeout=100)
       VEGAAA = ask.text
       chat_id = message.chat.id
       await app.set_chat_description(chat_id, VEGAAA)
       await message.reply_text(f"تم تغير بايو الجروب 「 {message.from_user.mention} 」بنجاح ✨")
   else:
        await message.reply("لازم تكون المالك ✨")
        
        
        
        
        
#تغير صوره الحروب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تغير صوره الحروب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command("تغير صوره الجروب", "") & filters.group & filters.group, group=287272828)
async def tasfaghhhgya(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == 8040979911:
        ask = await client.ask(message.chat.id, "ارسل لـي صوره الان", filters=filters.photo, timeout=100)
        photo = ask.photo.file_id if ask.photo else None
        if photo:
            chat_id = message.chat.id
            await client.set_chat_photo(chat_id=chat_id, photo=photo)
            await message.reply_text(f"︎تم تغير صوره الجروب 「 {message.from_user.mention} 」بنجاح ✨ ")
        else:
            await message.reply_text("لم يتم إرسال صورة. يرجى إعادة المحاولة.")
    else:
        await message.reply_text("لازم تكون ع الاقل ادمن او اعلي ✨")


#مسح صوره الحروب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#مسح صوره الحروب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command("مسح صوره الجروب", "") & filters.group & filters.group, group=28727282883737)
async def tasfaghhhgyahddh(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == 8040979911:
     if message.chat.photo:
         photo = await client.download_media(message.chat.photo.big_file_id)    
         await app.delete_chat_photo(message.chat.id)
         await client.send_photo(chat_id=message.chat.id, photo=photo, caption=f"<b>[سوࢪس فيࢪوטּ | 𝙎𝙤𝙪𝙧𝙘𝙚 𝙑𝙚𝙧𝙤𝙣. #]\n تم مسح صوره الجروب ✨\n بواسطة: {message.from_user.mention}</b>")
     else:
        await message.reply_text("هييه مافيه صوره لجروب ياروع!!")
    else:
        await message.reply_text("لازم تكون ع الاقل ادمن او اعلي ✨")



#تنبيه بتغير صوره الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تنبيه بتغير صوره الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.new_chat_photo & filters.group, group=8292)
async def changephoto(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    chat_id = message.chat.id
    photo = await client.download_media(message.chat.photo.big_file_id)
    response = f"<b>[سوࢪس فيࢪوטּ | 𝙎𝙤𝙪𝙧𝙘𝙚 𝙑𝙚𝙧𝙤𝙣. #]\n زوقك حلو : {message.from_user.mention} \n حلوه صوره الجروب الجديده </b>"
    await message.reply_photo(photo=photo, caption=response)
    
    



#تنبيه بتغير اسم الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#تنبيه بتغير اسم الجروب  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.new_chat_title & filters.group, group=8282828292)
async def changephoto(client, message):
    chat_id = message.chat.id
    await message.reply_text("<b>[سوࢪس فيࢪوטּ | 𝙎𝙤𝙪𝙧𝙘𝙚 𝙑𝙚𝙧𝙤𝙣. #]\n زوقك حلو : {message.from_user.mention}\n حلوه اسم الجروب الجديد </b>")


#انشاء رابط  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#انشاء رابط  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


@app.on_message(filters.command(["رابط","انشاء رابط","لينك"], "") & filters.group & filters.group, group=283277)
async def create_invite_link(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == OWNER_ID or message.from_user.id == 8040979911:
        link = await client.create_chat_invite_link(message.chat.id)
        await client.send_message(
            chat_id=message.chat.id,
            text=f"تم إنشاء رابط للجروب :\n {link.invite_link}"
        )
    else:
        await message.reply_text("لازم تكون ع الاقل ادمن او اعلي ✨")
    






#انذار ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#انذار ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


enzyof = []
@app.on_message(filters.command(["قفل انذار", "تعطيل الانذار"], "") & filters.group, group=27727181882)
async def enzylock(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == OWNER_ID or message.from_user.id == 8040979911:
      if message.chat.id in enzyof:
        return await message.reply_text("الانذار معطل اصلا ✨")
      enzyof.append(message.chat.id)
      return await message.reply_text("تم تعطيل الانذار بنجاح ✨")
   else:
      return await message.reply_text("لازم تكون ع الاقل ادمن او اعلي ✨")

@app.on_message(filters.command(["فتح انذار", "تفعيل الانذار"], "") & filters.group, group=7262627288)
async def enzyopen(client, message):
   get = await client.get_chat_member(message.chat.id, message.from_user.id)
   if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == 8040979911:
      if not message.chat.id in enzyof:
        return await message.reply_text("الانذار متفعل اصلا ✨")
      enzyof.remove(message.chat.id)
      return await message.reply_text("تم تفعيل الانذار بنجاح ✨")
   else:
      return await message.reply_text("لازم تكون ع الاقل ادمن او اعلي ✨")




sohaila = {}
kem_vee = 3

@app.on_message(filters.command(["انذار"], "") & filters.group, group=466670090009885)
async def tom(client, message):
    if message.chat.id in enzyof:
        return await message.reply_text("<b>الانذار معطل من قبل الادمن✨</b>")
    
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR] or message.from_user.id == OWNER_ID or message.from_user.id == 8040979911:
        me = message.from_user.id
        user_id = message.reply_to_message.from_user.id
        chat_id = message.chat.id
        
        if chat_id not in sohaila:
            sohaila[chat_id] = {}
        
        if user_id not in sohaila[chat_id]:
            sohaila[chat_id][user_id] = 1
        else:
            sohaila[chat_id][user_id] += 1
        
        await message.reply_text(f"{sohaila[chat_id][user_id]}")
        
        if sohaila[chat_id][user_id] >= kem_vee:
            try:
                del sohaila[chat_id][user_id]
                await client.ban_chat_member(chat_id, user_id)
                await message.reply("هطلع الكلب دا بره مش بيسمع الكلام..طرد")    
            except:
                await message.reply("مش عارف اطردو معه حصانه")


#التوب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
#التوب ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓


message_counts = {}

@app.on_message(filters.group & filters.group, group=55727211005)
async def update_message_count(_, message):
    group_id = message.chat.id
    user_id = message.from_user.id if message.from_user else "1121532100"
    
    key = (group_id, user_id)
    message_counts.setdefault(key, 0)
    message_counts[key] += 1

async def get_user_name(client, user_id):
    user = await client.get_users(user_id)
    return f"{user.first_name or ''} {user.last_name or ''}"

@app.on_message(filters.command("ترند", "") & filters.group & filters.group, group=55559190191)
async def get_top_users(client, message):
    group_id = message.chat.id   
    top_users = sorted(message_counts.items(), key=lambda x: x[1], reverse=True)[:5]
    response = "<u>افضل عشر متفاعلين:</u>\n\n"   
    for rank, ((group_id, user_id), message_count) in enumerate(top_users[:3], start=1):
        user_name = await get_user_name(client, user_id)
        medal = "🥇" if rank == 1 else "🥈" if rank == 2 else "🥉"
        response += f"{medal} {rank} : {user_name} | {message_count} ➥ رسايل\n"  
    for rank, ((group_id, user_id), message_count) in enumerate(top_users[3:], start=4):
        user_name = await get_user_name(client, user_id)
        response += f"{rank} : {user_name} | {message_count}\n ➥ رسايل\n"      
    await client.send_message(message.chat.id, response)





import random

ALI = ["👍", "❤", "🔥", "🥰", "🎉", "🤩", "🙏", "👌", "🕊", "😍", "😎","🍓","💋","💘","🌚"]

@app.on_message(filters.channel, group=12567)
async def handle_message(client, message):
    bot_username = client.me.username
    user = await get_assistant(bot_username)
    chat_id = message.chat.id
    message_id = message.id
    T = random.choice(ALI)
    try:
        await user.send_reaction(chat_id, message_id, f"{T}")
    except Exception as e:
        print(f"حدث خطأ أثناء الانضمام: {str(e)}")

@app.on_message(filters.new_chat_members)
async def join_watcher(_, message):
    try:
        if not await is_on_off(LOG):
            return
        userbot = await get_assistant(message.chat.id)
        chat = message.chat
        for members in message.new_chat_members:
            if members.id == app.id:
                count = await app.get_chat_members_count(chat.id)
                username = (
                    message.chat.username if message.chat.username else "ᴘʀɪᴠᴀᴛᴇ ᴄʜᴀᴛ"
                )
                msg = (
                    f"<b>تم اضافة البوت الي مجموعة جديده :</b>\n\n"
                    f"─────────────────────\n"
                    f"<b>╭❖ᚐᴄʜᴀᴛ ɴᴀᴍᴇ :</b> {message.chat.title}\n"
                    f"<b>│᚜❖ᴄʜᴀᴛ ɪᴅ :</b> {message.chat.id}\n"
                    f"<b>│᚜❖ᴄʜᴀᴛ ᴜsᴇʀɴᴀᴍᴇ :</b> @{username}\n"
                    f"<b>│᚜❖ᴄʜᴀᴛ ᴍᴇᴍʙᴇʀ ᴄᴏᴜɴᴛ :</b> {count}\n"
                    f"<b>╰❖ᚐᴀᴅᴅᴇᴅ ʙʏ :</b> {message.from_user.mention}"
                )
                await app.send_message(
                    LOGGER_ID,
                    text=msg,
                    reply_markup=InlineKeyboardMarkup(
                        [
                            [
                                InlineKeyboardButton(
                                    f"ᴀᴅᴅᴇᴅ ʙʏ",
                                    url=f"tg://openmessage?user_id={message.from_user.id}",
                                )
                            ]
                        ]
                    ),
                )
                await userbot.join_chat(f"{username}")
    except Exception as e:
        print(f"Error: {e}")


@app.on_message(filters.left_chat_member)
async def on_left_chat_member(_, message: Message):
    try:
        if not await is_on_off(LOG):
            return
        userbot = await get_assistant(message.chat.id)

        left_chat_member = message.left_chat_member
        if left_chat_member and left_chat_member.id == app.id:
            remove_by = (
                message.from_user.mention if message.from_user else "𝐔ɴᴋɴᴏᴡɴ 𝐔sᴇʀ"
            )
            title = message.chat.title
            username = (
                f"@{message.chat.username}" if message.chat.username else "ᴘʀɪᴠᴀᴛᴇ ᴄʜᴀᴛ"
            )
            chat_id = message.chat.id
            left = f"✫ <b><u>#تم طرد البوت </u></b> \n╭❖ᚐᴄʜᴀᴛ ɴᴀᴍᴇ : {title}\n│᚜❖ ᴄʜᴀᴛ ɪᴅ : {chat_id}\n╰❖ᚐnʀᴇᴍᴏᴠᴇᴅ ʙʏ : {remove_by}"
            await app.send_message(LOGGER_ID, text=left)
            await delete_served_chat(chat_id)
            await userbot.leave_chat(chat_id)
    except Exception as e:
        print(f"Error: {e}")







rdod = {}
answer = {}
respon = {}

@app.on_message(filters.regex("اضف رد"), group=1289712474)
async def lock_vaassd(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR]:
        user_id = message.from_user.id if message.from_user else "1121532100"
        ask = await app.ask(message.chat.id, "ارسل الكلمه الان", timeout=300)
        message1 = ask.text
        ask = await app.ask(message.chat.id, "ارسل الرد الان", timeout=300)
        answer_text = ask.text
        answer.setdefault(message.chat.id, []).append(message1)
        respon.setdefault(message.chat.id, []).append(answer_text)
        rdod[message.chat.id] = True
        await asyncio.sleep(6)
        await message.reply_text(f"• تم اضافه رد بواسطه ↤「 {message.from_user.mention}」")


@app.on_message(filters.text, group=1478212474)
async def delet_mediaaa(client, message):
    if message.chat.id in rdod and rdod[message.chat.id]:
        if message.text in answer.get(message.chat.id, []):
            index = answer[message.chat.id].index(message.text)
            response_text = respon[message.chat.id][index]
            await message.reply_text(response_text)

        
@app.on_message(filters.command("الردود", ""),group=4557857)
async def rdods(client, message: Message):
    try:
        index = answer[message.chat.id]
        response_text = respon[message.chat.id]
        text = "\n".join(f"{keyword}: {responses}" for keyword, responses in zip(index, response_text))
        await message.reply_text(text)
    except:
        await message.reply_text("لا توجد ردود مسجلة.")



@app.on_message(filters.command("مسح الردود", ""), group=45577857)
async def clear_responses(client, message: Message):
    if message.chat.id not in answer or not answer[message.chat.id]:
        await message.reply_text("لا توجد ردود مسجلة لإزالتها.")
        return
    del answer[message.chat.id]
    del respon[message.chat.id]
    await message.reply_text("تم مسح جميع الردود.")

@app.on_message(filters.regex("مسح رد"), group=1289712475)
async def delete_response(client, message):
    get = await client.get_chat_member(message.chat.id, message.from_user.id)
    if get.status in [ChatMemberStatus.OWNER, ChatMemberStatus.ADMINISTRATOR]:
        ask = await app.ask(message.chat.id, "ادخل الكلمه التي تريد حذف الرد لها", timeout=300)
        keyword = ask.text
        if keyword in answer.get(message.chat.id, []):
            index = answer[message.chat.id].index(keyword)
            answer[message.chat.id].pop(index)
            respon[message.chat.id].pop(index)
            await message.reply_text(f"• تم حذف الرد المرتبط بكلمة ↤︎「 {keyword}」")
        else:
            await message.reply_text("• الكلمة غير موجودة في الردود.")
